name: Warm Strapi (h24)

on:
  schedule:
    - cron: "*/10 * * * *"     # ogni 10 minuti, h24 (UTC)
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Warm health
        env:
          STRAPI_WARM_URL: "https://exciting-bee-34d313fccd.strapiapp.com/api/health"
        run: |
          echo "Ping $STRAPI_WARM_URL (h24)"
          sleep $((RANDOM % 20))
          for i in 1 2 3; do
            if curl -fsS --retry 0 --connect-timeout 5 -m 10 "$STRAPI_WARM_URL" -o /dev/null; then
              echo "OK (health)"; break
            fi
            echo "Retry $i..."
            sleep $((i*5))
          done
          true  # non fallire il job anche se i tentativi sono andati male
